<!--

    Unless explicitly acquired and licensed from Licensor under another license, the contents of
    this file are subject to the Reciprocal Public License ("RPL") Version 1.5, or subsequent
    versions as allowed by the RPL, and You may not copy or use this file in either source code
    or executable form, except in compliance with the terms and conditions of the RPL

    All software distributed under the RPL is provided strictly on an "AS IS" basis, WITHOUT
    WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, AND LICENSOR HEREBY DISCLAIMS ALL SUCH
    WARRANTIES, INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
    PARTICULAR PURPOSE, QUIET ENJOYMENT, OR NON-INFRINGEMENT. See the RPL for specific language
    governing rights and limitations under the RPL.

    http://opensource.org/licenses/RPL-1.5

    Copyright 2012-2017 Open Justice Broker Consortium

-->
<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<title>Disposition Form</title>
		<th:block th:include="fragments/general.html :: headerfiles"></th:block>
		<link rel="stylesheet" type="text/css" th:href="@{/webjars/datatables/1.10.19/css/dataTables.bootstrap4.min.css}" />
		<link rel="stylesheet" type="text/css" th:href="@{/webjars/font-awesome/5.2.0/css/all.css}" />
		<link href="https://cdn.jsdelivr.net/npm/gijgo@1.9.10/css/gijgo.min.css" rel="stylesheet" type="text/css" />
	</head>
	<body>
	    <!-- Begin page content -->
  <div th:fragment="dispositionForm">
    
    <form action="#" th:action="@{/daArrests/saveDisposition}" th:object="${disposition}" id="dispositionForm" method="post">
      <input type="hidden" th:field="*{arrestIdentification}" />
      <input type="hidden" th:field="*{dispositionIdentification}" />
      <input type="hidden" th:field="*{arrestDate}" />
      
      <div class="form-row">
        <div class="col-md-6 mb-3">
          <label>Charge at Arrest</label>
          <select th:field="*{arrestChargeIdentification}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid" autofocus>
          </select>
        </div>
        <div class="col-md-6 mb-2">
          <label>Court Name</label>
          <input type="text" th:field="*{daCourtName}" class="form-control form-control-sm" readonly/>
        </div>
      </div>
      <div class="form-row">
        <div class="col-md-3 mb-3">
          <label>Disposition Date
             <a href="#" data-toggle="popover" data-trigger="hover" 
                data-content="The date the 'disposition code' action occurred.  Includes declinations, case filings, dismissals, pleas and findings, etc…">
                <i class="fas fa-info-circle"></i></a>
          </label>
          <input type="text" th:field="*{dispositionDate}" placeholder="mm/dd/yyyy" class="date form-control form-control-sm" th:errorclass="is-invalid"/>
          <div th:if="${#fields.hasErrors('dispositionDate')}" th:errors="*{dispositionDate}" class="invalid-feedback">Disposition Date error message</div>
        </div>
        <div class="col-md-4 mb-4">
          <label for="dispositionCode">Disposition *
             <a href="#" data-toggle="popover" data-trigger="hover" 
                data-content="The action of the court or prosecutor relating to the charge.  Includes declinations, case filings, dismissals, pleas and findings, etc…">
                <i class="fas fa-info-circle"></i></a>
          </label>
          <select th:field="*{dispositionCode}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid">
             <option value="" >Please select ...</option>
   			     <option th:each="item: ${daDispoCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
          </select>
          <div th:if="${#fields.hasErrors('dispositionCode')}" th:errors="*{dispositionCode}" class="invalid-feedback">Disposition Code error message</div>
        </div>
        <div class="col-md-2 mb-2">
          <label for="counts">Counts *
             <a href="#" data-toggle="popover" data-trigger="hover" 
                data-content="This will default to 1. Increase as needed if the subject was charged with the same offense more than once resulting in the same disposition.  There is a maximum of 999.">
                <i class="fas fa-info-circle"></i></a>
          </label>
          <input type="number" min="1" max="999" th:field="*{counts}" width="1" class="form-control form-control-sm" th:errorclass="is-invalid"/>
          <div th:if="${#fields.hasErrors('counts')}" th:errors="*{counts}" class="invalid-feedback">Counts error message</div>
        </div>
        <div class="col-md-3 mb-3">
           <label>Reason For Dismissal
             <a href="#" data-toggle="popover" data-trigger="hover" 
                data-content="Include, if known, whenever the disposition code is CHARGES DISMISSED.">
                <i class="fas fa-info-circle"></i></a>
           </label>
          <select th:field="*{reasonForDismissal}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid" disabled>
             <option value="" >Please select ...</option>
             <option th:each="item: ${daReasonsForDismissalMapping}" th:value="${item.key}" th:text="${item.value}" />
          </select>
           <div th:if="${#fields.hasErrors('reasonForDismissal')}" th:errors="*{reasonForDismissal}" class="invalid-feedback">Reason for dismissal error message</div>
        </div>
        </div>
        <div class="form-row">
          <div class="col-md-6 mb-4">
            <label>Filed Charge *
              <a href="#" data-toggle="popover" data-trigger="hover" 
                 data-content="Original charge as filed by the prosecutor. This may be the same or different from the charge at arrest.  
                  If the final charge is different than the 'filed charge', the new charge will be in the AMENDED CHARGE field.">
                 <i class="fas fa-info-circle"></i></a>
            </label>
	          <input type="text" th:field="*{filedChargeLiteral}" class="form-control form-control-sm mb-1" readonly data-toggle="popover" data-trigger="hover" 
	               data-content="Filed Charge Literal"/>
	          <select th:field="*{filedCharge}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid">
	             <option value="" >Please select ...</option>
	             <option th:each="item: ${daFiledChargeCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
	          </select>
            <div th:if="${#fields.hasErrors('filedCharge')}" th:errors="*{filedCharge}" class="invalid-feedback">Filed charge error message</div>
          </div>
          <div class="col-md-6 mb-4">
            <label>Amended Charge
              <a href="#" data-toggle="popover" data-trigger="hover" 
                 data-content="If the final offense is different than the FILED CHARGE, the new charge will be the AMENDED CHARGE.">
                 <i class="fas fa-info-circle"></i></a>
            </label>
	          <input type="text" th:field="*{amendedChargeLiteral}" class="form-control form-control-sm mb-1" readonly data-toggle="popover" data-trigger="hover" 
	               data-content="Amended Charge Literal"/>
            <select th:field="*{amendedCharge}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid" disabled>
               <option value="" >Please select ...</option>
               <option th:each="item: ${daAmendedChargeCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
            </select>
            <div th:if="${#fields.hasErrors('amendedCharge')}" th:errors="*{amendedCharge}" class="invalid-feedback">Amended charge error message</div>
          </div>
        </div>
        <div class="form-row">
         <div class="col-md-6 mb-4">
           <label for="chargeSeverityCode">Filed Charge Severity
             <a href="#" data-toggle="popover" data-trigger="hover" 
                data-content="Felony or Misdemeanor">
                <i class="fas fa-info-circle"></i></a>
           </label>
           <select th:field="*{chargeSeverityCode}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid">
              <option value="" >Please select ...</option>
              <option th:each="item: ${chargeSeverityCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
           </select>
           <div th:if="${#fields.hasErrors('chargeSeverityCode')}" th:errors="*{chargeSeverityCode}" class="invalid-feedback">Filed Charge Severity error message</div>
         </div>
         <div class="col-md-6 mb-4">
           <label for="amendedChargeSeverityCode">Amended Charge Severity
              <a href="#" data-toggle="popover" data-trigger="hover" 
                 data-content="Felony or Misdemeanor">
                 <i class="fas fa-info-circle"></i></a>
           </label>
           <select th:field="*{amendedChargeSeverityCode}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid" disabled>
              <option value="" >Please select ...</option>
              <option th:each="item: ${chargeSeverityCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
           </select>
           <div th:if="${#fields.hasErrors('amendedChargeSeverityCode')}" th:errors="*{amendedChargeSeverityCode}" class="invalid-feedback">Amended sCharge Severity error message</div>
         </div>
        </div>
        <div class="form-row">
          <div class="col-md-3 mb-3">
            <label for="generalOffenseCode">General Offense Code
              <a href="#" data-toggle="popover" data-trigger="hover" 
                 data-content="Options include ATTEMPTED or AFTER FELONY CONVICTION.  
                 Only use if the General Offense Code is not built into offense charge. For example, 
                 it would be unnecessary to use AFTER FELONY CONVICTION if the charge is POSSESSION OF A FIREARM AFTER FELONY CONVICTION.">
                 <i class="fas fa-info-circle"></i></a>
            </label>
            <select th:field="*{generalOffenseCode}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid">
               <option value="" >Please select ...</option>
               <option th:each="item: ${daGeneralOffenseCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
            </select>
            <div th:if="${#fields.hasErrors('generalOffenseCode')}" th:errors="*{generalOffenseCode}" class="invalid-feedback">General Offense Code error message</div>
          </div>
          <div class="col-md-3 mb-3">
            <label>Fine Amount</label>
            <input type="text" th:field="*{fineAmount}" width="250" class="money form-control form-control-sm" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('fineAmount')}" th:errors="*{fineAmount}" class="invalid-feedback">Fine amount error message</div>
          </div>
          <div class="col-md-3 mb-3">
            <label>Fine Suspended
              <a href="#" data-toggle="popover" data-trigger="hover" 
                 data-content="Must be less than or equal to the fine amount.">
                 <i class="fas fa-info-circle"></i></a>
            </label>
            <input type="text" th:field="*{fineSuspended}" width="250" class="money form-control form-control-sm" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('fineSuspended')}" th:errors="*{fineSuspended}" class="invalid-feedback">Fine suspended error message</div>
          </div>
          <div class="col-md-3 mb-3">
             <label>Restitution</label>
             <input type="text" th:field="*{restitution}" width="10" class="money form-control form-control-sm" th:errorclass="is-invalid"/>
             <div th:if="${#fields.hasErrors('restitution')}" th:errors="*{restitution}" class="invalid-feedback">Restitution error message</div>
           </div>                         
          
        </div>
        <div class="form-row">
          <div class="col-md-3 mb-3 border pb-1">
            <label>Prison</label>
              <a href="#" data-toggle="popover" data-trigger="hover" 
                 data-content="Prison Time is served under the Department of Corrections. 
                   Prison Time can only be populated if Charge Severity = felony and Court Case Number Case Type = F.  
                   Prison Days cannot exceed 359.  360 prison days = 1 prison year.  Each month = 30 days. 6 months = 180 days.  ">
                 <i class="fas fa-info-circle"></i></a><br>
            <label>Years</label>
            <input type="number" min="1" max="100" th:field="*{prisonYears}" width="1" class="form-control form-control-sm provision-prerequisite allow-suspended-time" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('jailYears')}" th:errors="*{prisonYears}" class="invalid-feedback">Prison years error message</div>
            <label>Days</label>
            <input type="number" min="1" max="359" th:field="*{prisonDays}" width="3" class="form-control form-control-sm provision-prerequisite allow-suspended-time" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('prisonDays')}" th:errors="*{prisonDays}" class="invalid-feedback">Prison days error message</div>
          </div>
          <div class="col-md-3 pb-1 mb-3 border-bottom border-top border-right">
            <label>Jail
            <a href="#" data-toggle="popover" data-trigger="hover" 
               data-content="Jail is served in County Jail.  Years can be blank or 1, Days cannot exceed 359.  Each month = 30 days. 6 months = 180 days.  ">
               <i class="fas fa-info-circle"></i></a></label><br>
            <label>Years</label>
            <input type="number" min="1" max="100" th:field="*{jailYears}" width="1" class="form-control form-control-sm provision-prerequisite allow-suspended-time" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('jailYears')}" th:errors="*{jailYears}" class="invalid-feedback">Jail years error message</div>
            <label>Days</label>
            <input type="number" min="1" max="359" th:field="*{jailDays}" width="3" class="form-control form-control-sm provision-prerequisite allow-suspended-time" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('jailDays')}" th:errors="*{jailDays}" class="invalid-feedback">Jail days error message</div>
          </div>
          <div class="col-md-3 mb-3 pb-1 border-bottom border-top border-right">
            <label>Suspended</label>
            <a href="#" data-toggle="popover" data-trigger="hover" 
               data-content="Suspended time cannot be greater than Prison/Jail time. ">
               <i class="fas fa-info-circle"></i></a> <br>
            <label>Years</label>
            <input type="number" min="1" max="100" th:field="*{suspendedYears}" width="1" class="form-control form-control-sm suspended-time" th:errorclass="is-invalid" disabled/>
            <div th:if="${#fields.hasErrors('suspendedYears')}" th:errors="*{suspendedYears}" class="invalid-feedback">Suspended years error message</div>
            <label>Days</label>
            <input type="number" min="1" max="359" th:field="*{suspendedDays}" width="3" class="form-control form-control-sm suspended-time" th:errorclass="is-invalid" disabled/>
            <div th:if="${#fields.hasErrors('suspendedDays')}" th:errors="*{suspendedDays}" class="invalid-feedback">Suspended days error message</div>
          </div>
          <div class="col-md-3 mb-3 pb-1 border-bottom border-right border-top">
            <label>Deferred  <a href="#" data-toggle="popover" data-trigger="hover" 
               data-content="Days cannot exceed 359.  Each month = 30 days. 6 months = 180 days. 
                Cannot have deferred time and time in Prison or Suspended for same charge.  ">
              <i class="fas fa-info-circle"></i></a>
            </label> <br>
            <label>Years</label>
            <input type="number" min="1" max="100" th:field="*{deferredYears}" width="1" class="form-control form-control-sm provision-prerequisite" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('deferredYears')}" th:errors="*{deferredYears}" class="invalid-feedback">Deferred years error message</div>
            <label>Days</label>
            <input type="number" min="1" max="359" th:field="*{deferredDays}" width="3" class="form-control form-control-sm provision-prerequisite" th:errorclass="is-invalid"/>
            <div th:if="${#fields.hasErrors('deferredDays')}" th:errors="*{deferredDays}" class="invalid-feedback">Deferred days error message</div>
          </div>
        </div>
        <div class="form-row">
          <div class="col-md-6 mb-4">
            <label>Provision
               <a href="#" data-toggle="popover" data-trigger="hover" 
                  data-content="Concurrent sentences run at the same time; Consecutive sentences run one after another.  ">
                  <i class="fas fa-info-circle"></i></a>
            </label>
            <select th:field="*{provisionCode}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid" disabled>
              <option value="" >Please select ...</option>
              <option th:each="item: ${daProvisionCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
            </select>
            <div th:if="${#fields.hasErrors('provisionCode')}" th:errors="*{provisionCode}" class="invalid-feedback">Provision error message</div>
          </div>                         
           <div class="col-md-6 mb-4">
             <label>Additional Sentence
                <a href="#" data-toggle="popover" data-trigger="hover" 
                   data-content="Information related to the disposition that cannot be reported using one of the previous fields.  
                   (e.g. COMMUNITY SERVICE, FINE AND COSTS, SERVING WEEKENDS ONLY, etc...)">
                   <i class="fas fa-info-circle"></i></a>
             </label>
            <select th:field="*{alternateSentences}" class="form-control form-control-sm chosen-select" multiple="multiple" th:errorclass="is-invalid" data-placeholder="Please select all that apply...">
              <option value="" ></option>
              <option th:each="item: ${daAlternateSentenceMapping}" th:value="${item.key}" th:text="${item.value}" />
            </select>
             <div th:if="${#fields.hasErrors('alternateSentences')}" th:errors="*{alternateSentences}" class="invalid-feedback">Alternate sentence error message</div>
           </div>		
         </div>			                
         <div class="form-row">
            <div class="col-md-3 mb-3">
            <label>Court Case Number* </label>
            </div>
            <div class="col-md-2 mb-2">
             <label>County </label>
            <input type="text" th:field="*{county}" class="form-control form-control-sm" th:errorclass="is-invalid" readonly/>
            <div th:if="${#fields.hasErrors('county')}" th:errors="*{county}" class="invalid-feedback">County error message</div>
            </div>
            <div class="col-md-3 mb-2">
             <label>Case Type </label>
            <select th:field="*{caseType}" class="form-control form-control-sm chosen-select" th:errorclass="is-invalid">
               <option value="" >Please select ...</option>
               <option th:each="item: ${daCaseTypeCodeMapping}" th:value="${item.key}" th:text="${item.value}" />
             </select>
             <div th:if="${#fields.hasErrors('caseType')}" th:errors="*{caseType}" class="invalid-feedback">Case Type error message</div>
            </div>
            <div class="col-md-2 mb-2">
             <label>Year </label>
             <input type="text" th:field="*{year}" class="form-control form-control-sm" th:errorclass="is-invalid"/>
             <div th:if="${#fields.hasErrors('year')}" th:errors="*{year}" class="invalid-feedback">Year error message</div>
            </div>
            <div class="col-md-2 mb-2">
             <label>Case Number </label>
             <input type="text" th:field="*{caseNumber}" class="form-control form-control-sm" th:errorclass="is-invalid"/>
             <div th:if="${#fields.hasErrors('caseNumber')}" th:errors="*{caseNumber}" class="invalid-feedback">Case Number error message</div>
            </div>
         </div>					                
      </form>
    <script th:inline="javascript">
		    /*<![CDATA[*/
		    /*]]>*/

	      $(function(){
	    	  $('[data-toggle="popover"]').prop('tabIndex', -1).popover();
	    	  $(".chosen-select").chosen(); 
					$('.date').mask('99/99/9999');
					$('.money').mask('0,000,000,000,000', {reverse: true});
			    $('#county').mask('99');
			    $('#year').mask('99');
			    $('#caseNumber').mask('99999');
			    $("#arrestChargeIdentification").trigger('chosen:activate');
					
					$("#dispositionForm").on("focus", "#dispositionDate", function(){
		          $('#dispositionDate').datepicker({
		              uiLibrary: 'bootstrap4', size: 'small'
		           });
					});
					
          // 43 -> 348 - Found guilty of different charge
          // 70 -> 376 - pled guilty of other charge
          //107 -> 520 - Nolo contendere to different charge
					var dispoCodesForAmendedCharge = ['43', '70', '107'];
					// 6 -> 305
					var dispoCodesForDismissalReason = ['6']; //305-charge dismissal
					if (dispoCodesForAmendedCharge.includes($('#dispositionCode').val())){
					 $('#amendedCharge').prop('disabled', false).trigger("chosen:updated");
					}
					
					if ($("#amendedCharge").val()){
						$('#amendedChargeSeverityCode').prop('disabled', false).trigger("chosen:updated");
					}
	     	   
					if (dispoCodesForDismissalReason.includes($('#dispositionCode').val())){
					 $('#reasonForDismissal').prop('disabled', false).trigger("chosen:updated");
					}
	     	   
			    toggleAlternateSentenceFineCostsOption();
			    toggleAlternateSentenceRestitutionOption();
					toggleSentenceInfo();
					toggleSuspendedInputs();
	        toggleDefferredYearsDays();
			    toggleProvisionCode();
					
					if ($('#jailYears').val() > 0){
					 	$('#suspendedYears').prop('disabled', false); 
			      $('#suspendedDays').prop('disabled', false); 
            $('#deferredYears').val(''); 
            $('#deferredDays').val(''); 
					 	$('#deferredYears').prop('disabled', true); 
					 	$('#deferredDays').prop('disabled', true); 
					}
					
					if ($('#jailDays').val() > 0){
            $('#suspendedDays').prop('disabled', false); 
					}
					
					if ($('#prisonYears').val() > 0  || $('#prisonDays').val() > 0 ){
						
						if ($('#prisonYears').val() > 0){
		           $('#suspendedYears').prop('disabled', false); 
	             $('#suspendedDays').prop('disabled', false); 
						}
            $('#deferredYears').val(''); 
            $('#deferredDays').val(''); 
            $('#deferredYears').prop('disabled', true); 
            $('#deferredDays').prop('disabled', true); 
          }
					
          $("#dispositionForm").on("change", "#jailYears", function(){
              if ($('#jailYears').val() > '0'){
                  $('#suspendedYears').prop('disabled', false); 
                  $('#suspendedDays').prop('disabled', false); 
                  $('#deferredYears').val(''); 
                  $('#deferredDays').val(''); 
                  $('#deferredYears').prop('disabled', true); 
                  $('#deferredDays').prop('disabled', true); 
              }
              else{
            	    if (!($('#prisonYears').val() > 0)){ //TODO confirm with Andrew 
	                  $('#suspendedYears').val(''); 
	                  $('#suspendedYears').prop('disabled', true);
            	    }
                  
                  if (!($('#prisonYears').val() > 0  || $('#prisonDays').val() > 0)){
                	  toggleDefferredYearsDays();              
                  }
              }
          });
					
          $("#dispositionForm").on("change", "#prisonYears", function(){
              if ($('#prisonYears').val() > '0'){
                  $('#suspendedYears').prop('disabled', false); //TODO confirm with Andrew 
                  $('#suspendedDays').prop('disabled', false);  //TODO confirm with Andrew 
                  $('#deferredYears').val(''); 
                  $('#deferredDays').val(''); 
                  $('#deferredYears').prop('disabled', true); 
                  $('#deferredDays').prop('disabled', true); 
              }
              else{
	            	  if (!($('#jailYears').val() > 0)){
	                  $('#suspendedYears').val(''); //TODO confirm with Andrew 
	                  $('#suspendedYears').prop('disabled', true);//TODO confirm with Andrew
	            	  }
                  
                  if (!($('#jailYears').val() > 0  || $('#prisonDays').val() > 0)){
                	  toggleDefferredYearsDays();              
                  }
              }
          });
					
          $("#dispositionForm").on("change", "#jailDays", function(){
              if ($('#jailDays').val() > 0){
                  $('#suspendedDays').prop('disabled', false); 
              }
              else{
            	  if (!($('#jailYears').val() > 0)){
                  $('#suspendedDays').val(''); 
                  $('#suspendedDays').prop('disabled', true);
            	  }
              }
          });
					
          $("#dispositionForm").on("change", "#amendedCharge", function(){
              if ($("#amendedCharge").val()){
                $('#amendedChargeSeverityCode').prop('disabled', false).trigger("chosen:updated");
              }
              else{
            	  $('#amendedChargeSeverityCode').val('');
            	  $('#amendedChargeSeverityCode').prop('disabled', true).trigger("chosen:updated");
              }
          });
					
          $("#dispositionForm").on("change", "#prisonDays", function(){
              if ($('#prisonDays').val() > 0){
                  $('#suspendedDays').prop('disabled', false); //TODO confirm with Andrew 
                  $('#deferredYears').val(''); 
                  $('#deferredYears').prop('disabled', true); 
                  $('#deferredDays').val(''); 
                  $('#deferredDays').prop('disabled', true); 
              }
              else{
            	   if (!($('#prisonYears').val() > 0)){  //TODO confirm with Andrew.  prison and suspended info relationship.
	                  $('#suspendedDays').val(''); 
	                  $('#suspendedDays').prop('disabled', true);
            	   }
                 if (!($('#jailYears').val() > 0  || $('#prisonYears').val() > 0)){
                     toggleDefferredYearsDays();              
                 }
              }
          });
          
          $("#dispositionForm").on("change", ".provision-prerequisite", function(){
              toggleProvisionCode();
          });
					
          $("#dispositionForm").on("change", ".allow-suspended-time", function(){
        	    toggleSuspendedInputs();
          });
          
          $("#dispositionForm").on("change", ".suspended-time", function(){
              toggleDefferredYearsDays();
          });
          
          $("#dispositionForm").on("change", "#fineAmount", function(){
        	  toggleAlternateSentenceFineCostsOption();
          });
					
          $("#dispositionForm").on("change", "#restitution", function(){
        	  toggleAlternateSentenceRestitutionOption();
          });
					
		  	  $("#dispositionForm").on("change", "#dispositionCode", function(){
		          if (dispoCodesForAmendedCharge.includes($('#dispositionCode').val())){
		            $('#amendedCharge').prop('disabled', false).trigger("chosen:updated");
	            }
		          else{
		        	  $('#amendedCharge').val('');
		        	  $('#amendedCharge').prop('disabled', true).trigger("chosen:updated");
		        	  $('#amendedChargeSeverityCode').val('');
		        	  $('#amendedChargeSeverityCode').prop('disabled', true).trigger("chosen:updated");
		          }
		          
		          if (dispoCodesForDismissalReason.includes($('#dispositionCode').val())){
		        	  $('#reasonForDismissal').prop('disabled', false).trigger("chosen:updated");
		          }
		          else{
		        	  $('#reasonForDismissal').val('');
		        	  $('#reasonForDismissal').prop('disabled', true).trigger("chosen:updated");
		          }
		          
		          toggleSentenceInfo();
		          toggleSuspendedInputs();
              toggleDefferredYearsDays();
		  	  });
		  	  
          $('#dispositionForm input').keypress(function (e) {
              if (e.which == 13) {
                $('#saveDisposition').click();
                return false;    
              }
          });


        });
		    
		    /*
		      ID CODE DESCRIPTION
		      2   301 ACQUITTED
		      3   302 ACQUIT-INSANE
					6   305 CHARGE DISMISSED
					7   306 DISMISS-INSANE
					8   307 DISMIS-MENTAL INCOMPET
					15  314 EXTRADITED
					19  320 MISTRIAL-DISCHARGED
					28  331 BAIL FORFEITED
					71  377 PLED NOT GUILTY,CASE DISMISSED
					84  390 DA DECLINED TO FILE CHARGE
					89  398 CHARGES FILED
					96  505 REFERRED TO FEDERAL PROSECUTOR
					101 510 APPLICATION TO ACCELERATE DEFERRED SENT DISMISSED
					102 511 APPLICATION TO REVOKE SUSPENDED SENTENCE DISMISSED
					110 524 SENTENCED TO DRUG COURT
					115 530 DEPORTED
					165 537 FAILURE TO APPEAR
					167 539 FAILURE TO PAY
					166 540 FAILURE TO COMPLY
					164 541 APPLICATION TO REVOKE
					163 542 APPLICATION TO ACCELERATE
		    */
        var dispoCodesWithoutSentence = ['2', '3', '6', '7', '8', '15', '19', '28', '71', 
            '84', '89', '96', '101', '102', '110', '115', '165','167', '166', '164','163'];

	      function toggleDefferredYearsDays(){
	          /* 74 -> 380, 82->388 */
	          var dispoCodesWithoutDeferredYearsDays = ['74', '82'];

            if (dispoCodesWithoutSentence.includes($('#dispositionCode').val()) 
            		|| dispoCodesWithoutDeferredYearsDays.includes($('#dispositionCode').val())
            		|| $('#suspendedYears').val() > 0 
            		|| $('#suspendedDays').val() > 0){
                $('#deferredYears').val('');
                $('#deferredYears').prop('disabled', true);
                $('#deferredDays').val('');
                $('#deferredDays').prop('disabled', true);
            }
            else{
                $('#deferredYears').prop('disabled', false);
                $('#deferredDays').prop('disabled', false);
            }
	      }
	      
        function toggleProvisionCode(){
              var $provisionPrerequisiteInputs = $('.provision-prerequisite');
              if ($provisionPrerequisiteInputs.filter(function(){ return $(this).val() > 0; }).length){
                $('#provisionCode').prop('disabled', false).trigger("chosen:updated");
              }
              else{
                $('#provisionCode').val('');
                $('#provisionCode').prop('disabled', true).trigger("chosen:updated");
              }
        }
	        
        function toggleSentenceInfo(){
           if (dispoCodesWithoutSentence.includes($('#dispositionCode').val())){
                $('#fineAmount').val('');
                $('#fineAmount').prop('disabled', true);
                $('#fineSuspended').val('');
                $('#fineSuspended').prop('disabled', true);
                $('#jailYears').val('');
                $('#jailYears').prop('disabled', true);
                $('#jailDays').val('');
                $('#jailDays').prop('disabled', true);
                $('#prisonYears').val('');
                $('#prisonYears').prop('disabled', true);
                $('#prisonDays').val('');
                $('#prisonDays').prop('disabled', true);
                $('#suspendedYears').val('');
                $('#suspendedYears').prop('disabled', true);
                $('#suspendedDays').val('');
                $('#suspendedDays').prop('disabled', true);
                $('#deferredYears').val('');
                $('#deferredYears').prop('disabled', true);
                $('#deferredDays').val('');
                $('#deferredDays').prop('disabled', true);
                $('#restitution').val('');
                $('#restitution').prop('disabled', true);
                $('#alternateSentences option').removeAttr('selected');
                $('#alternateSentences').prop('disabled', true).trigger("chosen:updated");
          }
          else{
                $('#fineAmount').prop('disabled', false);
                $('#fineSuspended').prop('disabled', false);
                $('#jailYears').prop('disabled', false);
                $('#jailDays').prop('disabled', false);
                $('#prisonYears').prop('disabled', false);
                $('#prisonDays').prop('disabled', false);
                $('#restitution').prop('disabled', false);
                $('#alternateSentences').prop('disabled', false);
                toggleDefferredYearsDays();
                toggleAlternateSentenceFineCostsOption();
                toggleAlternateSentenceRestitutionOption();
          }
        }
        
        function toggleAlternateSentenceFineCostsOption(){
            if ($("#fineAmount").val() > 0){
                $('#alternateSentences option[value="30"]').prop('disabled', true);
                $('#alternateSentences option[value="64"]').prop('disabled', true);
                $('#alternateSentences option[value="63"]').prop('disabled', true);
                $('#alternateSentences option[value="27"]').prop('disabled', true);
                $('#alternateSentences option[value="62"]').prop('disabled', true);
                $('#alternateSentences option[value="28"]').prop('disabled', true); 
                $('#alternateSentences').trigger("chosen:updated");
            }
            else{
                $('#alternateSentences option[value="30"]').prop('disabled', false);
                $('#alternateSentences option[value="64"]').prop('disabled', false);
                $('#alternateSentences option[value="63"]').prop('disabled', false);
                $('#alternateSentences option[value="27"]').prop('disabled', false);
                $('#alternateSentences option[value="62"]').prop('disabled', false);
                $('#alternateSentences option[value="28"]').prop('disabled', false);
                $('#alternateSentences').trigger("chosen:updated");
            }
        }
        
        function toggleAlternateSentenceRestitutionOption(){
            if ($("#restitution").val() > 0){
                $('#alternateSentences option[value="37"]').prop('disabled', true);
                $('#alternateSentences option[value="38"]').prop('disabled', true);
                $('#alternateSentences').trigger("chosen:updated");

            }
            else{
                $('#alternateSentences option[value="37"]').prop('disabled', false);
                $('#alternateSentences option[value="38"]').prop('disabled', false);
                $('#alternateSentences').trigger("chosen:updated");

            }
        }
        
        function toggleSuspendedInputs(){
            var $alloweSuspendedTimeInputs = $('.allow-suspended-time');
            if ($alloweSuspendedTimeInputs.filter(function(){
                  return $(this).val() > 0;}).length){
                 var jailYears = parseInt($("#jailYears").val()) || 0; 
                 var jailDays = parseInt($("#jailDays").val()) || 0; 
                 var jailTime = 360 * jailYears + jailDays;
                
                 var prisonYears = parseInt($("#prisonYears").val()) || 0; 
                 var prisonDays = parseInt($("#prisonDays").val()) || 0; 
                 var prisonTime = 360 * prisonYears + prisonDays; 

                 if ( jailTime > 359 || prisonTime > 359){
                     $('#suspendedYears').prop('disabled', false); 
                     $('#suspendedDays').prop('disabled', false);
                 }
                 else{
                     $('#suspendedDays').prop('disabled', false);
                     $('#suspendedYears').val('');
                     $('#suspendedYears').prop('disabled', true);
                 }
            }
            else{
                $('#suspendedYears').val('');
                $('#suspendedYears').prop('disabled', true); 
                $('#suspendedDays').val('');
                $('#suspendedDays').prop('disabled', true); 
            }
        }
        
    </script>
  </div>
	</body>
</html>

